"use strict";(()=>{var e={};e.id=7685,e.ids=[7685],e.modules={35010:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>u});var a=t(61871),n=t(93139),i=e([n]);n=(i.then?(await i)():i)[0];let o=Number(process.env.BCRYPT_SALT_ROUNDS||10);async function u(e,r){let t=Number(e.query.id);if(Number.isNaN(t))return r.status(400).json({error:"Invalid id"});try{if("GET"===e.method){let[e]=await a.d.query("SELECT id, email, username, name, status FROM users WHERE id = ?",[t]),s=e[0];if(!s)return r.status(404).json({error:"User not found"});return r.status(200).json(s)}if("PUT"===e.method||"PATCH"===e.method){let{email:s,username:i,password:u,name:d,status:l}=e.body??{},[E]=await a.d.query("SELECT * FROM users WHERE id = ?",[t]),m=E[0];if(!m)return r.status(404).json({error:"User not found"});let f="string"==typeof s&&""!==s.trim()?s.trim():m.email,p="string"==typeof i&&""!==i.trim()?i.trim():m.username;if(f!==m.email){let[e]=await a.d.query("SELECT id FROM users WHERE email = ? AND id != ?",[f,t]);if(e.length>0)return r.status(409).json({error:"Email already in use"})}if(p!==m.username){let[e]=await a.d.query("SELECT id FROM users WHERE username = ? AND id != ?",[p,t]);if(e.length>0)return r.status(409).json({error:"Username already in use"})}let c="string"==typeof u&&""!==u?await n.default.hash(u,o):m.password_hash,y="string"==typeof d&&""!==d?d:m.name,P=Object.prototype.hasOwnProperty.call(e.body,"status")&&null!==l&&""!==l?l:m.status;await a.d.query("UPDATE users SET email = ?, username = ?, password_hash = ?, name = ?, status = ? WHERE id = ?",[f,p,c,y??null,P??!1,t]);let[h]=await a.d.query("SELECT id, email, username, name, status FROM users WHERE id = ?",[t]);return r.status(200).json(h[0])}if("DELETE"===e.method){let[e]=await a.d.query("DELETE FROM users WHERE id = ?",[t]),s=e.affectedRows??0;if(0===s)return r.status(404).json({error:"User not found"});return r.status(204).end()}return r.status(405).json({error:"Method not allowed"})}catch(e){return console.error(e),r.status(500).json({error:"Server error"})}}s()}catch(e){s(e)}})},46387:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},49211:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},53237:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>d,routeModule:()=>E});var a=t(64592),n=t(46387),i=t(49211),u=t(35010),o=e([u]);u=(o.then?(await o)():o)[0];let d=(0,i.M)(u,"default"),l=(0,i.M)(u,"config"),E=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/users/[id]",pathname:"/api/users/[id]",bundlePath:"",filename:""},userland:u});s()}catch(e){s(e)}})},61871:(e,r,t)=>{t.d(r,{d:()=>l});let s=require("mysql2/promise");var a=t.n(s);let{MYSQL_HOST:n,MYSQL_PORT:i,MYSQL_USER:u,MYSQL_PASSWORD:o,MYSQL_DATABASE:d}=process.env;if(!n||!u||!d)throw Error("Missing MySQL environment variables");let l=a().createPool({host:n,port:Number(i||3306),user:u,password:o,database:d,connectionLimit:10})},64592:(e,r,t)=>{e.exports=t(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},93139:e=>{e.exports=import("bcryptjs")}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=53237);module.exports=t})();